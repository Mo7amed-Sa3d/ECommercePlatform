@startuml
!define TABLE(name,desc) class name as "desc" << (T,#FFAAAA) >>
!define PK(x) <b>x</b>
!define FK(x) <i>x</i>

' USERS
TABLE(Users, "Users") {
    PK(id) : CHAR(36)
    email : UNIQUE VARCHAR
    first_name : VARCHAR
    last_name : VARCHAR
    phone: VARCHAR
    is_seller: BOOLEAN
    password_hash : VARCHAR
    created_at : TIMESTAMP
    last_login : TIMESTAMP
}

' SELLERS
TABLE(Sellers, "Sellers") {
    PK(id) : CHAR(36)
    FK(seller_id) : CHAR(36)
    store_name : VARCHAR
    verified : BOOLEAN
    created_at : TIMESTAMP
}

' CATEGORIES
TABLE(Categories, "Categories") {
    PK(id) : INT
    name : VARCHAR
    FK(parent_category_id) : INT
}

' PRODUCTS
TABLE(Products, "Products") {
    PK(id) : CHAR(36)
    FK(seller_id) : CHAR(36)
    FK(brand_id) : bigint
    sku : VARCHAR
    title : VARCHAR
    description : TEXT
    base_price : DECIMAL
    active : BOOLEAN
    has_variant: BOOLEAN
    created_at : TIMESTAMP
}

' PRODUCT VARIANTS
TABLE(ProductVariants, "Product Variants") {
    PK(id) : CHAR(36)
    FK(product_id) : CHAR(36)
    sku : VARCHAR
    attributes : JSON
    price : DECIMAL
    weight_grams : INT
    stock_size: INT
}

' PRODUCT IMAGES
TABLE(ProductImages, "Product Images") {
    PK(id) : CHAR(36)
    FK(product_id) : CHAR(36)
    url : VARCHAR
    alt_text : VARCHAR
    display_order : INT
}

' PRODUCT CATEGORY (M:N)
TABLE(ProductCategory, "Product-Category") {
    FK(product_id) : CHAR(36)
    FK(category_id) : INT
}


' ADDRESSES
TABLE(Addresses, "Addresses") {
    PK(id) : CHAR(36)
    FK(user_id) : CHAR(36)
    full_name : VARCHAR
    line1 : VARCHAR
    line2 : VARCHAR
    city : VARCHAR
    region : VARCHAR
    postal_code : VARCHAR
    country : VARCHAR
    phone : VARCHAR
}

' ORDERS
TABLE(Orders, "Orders") {
    PK(id) : CHAR(36)
    FK(user_id) : CHAR(36)
    FK(shipment_id) : CHAR(36)
    FK(payment_id) : CHAR(36)
    status : VARCHAR
    total_amount : DECIMAL
    currency : CHAR(3)
    created_at : TIMESTAMP
}

' ORDER ITEMS
TABLE(OrderItems, "Order Items") {
    PK(id) : CHAR(36)
    FK(order_id) : CHAR(36)
    FK(variant_id) : CHAR(36)
    quantity : INT
    unit_price : DECIMAL
    tax_amount : DECIMAL
}

' PAYMENTS
TABLE(Payments, "Payments") {
    PK(id) : CHAR(36)
    FK(order_id) : CHAR(36)
    provider : VARCHAR
    provider_txn_id : VARCHAR
    status : VARCHAR
    amount : DECIMAL
    paid_at : TIMESTAMP
}

' SHIPMENTS
TABLE(Shipments, "Shipments") {
    PK(order_id) : CHAR(36)
    carrier : VARCHAR
    tracking_number : VARCHAR
    status : VARCHAR
    shipped_at : TIMESTAMP
    delivered_at : TIMESTAMP
}

' REVIEWS
TABLE(Reviews, "Reviews") {
    PK(id) : CHAR(36)
    FK(product_id) : CHAR(36)
    FK(user_id) : CHAR(36)
    rating : INT
    title : VARCHAR
    body : TEXT
    created_at : TIMESTAMP
}

' CARTS
TABLE(Carts, "Carts") {
    PK(id) : CHAR(36)
    FK(user_id) : CHAR(36)
    updated_at : TIMESTAMP
}

' CART ITEMS
TABLE(CartItems, "Cart Items") {
    PK(id) : CHAR(36)
    FK(cart_id) : CHAR(36)
    FK(product_id): CHAR(36)
    FK(variant_id) : CHAR(36)
    quantity : INT
}

' WISHLISTS
TABLE(Wishlists, "Wishlists") {
    PK(id) : CHAR(36)
    FK(user_id) : CHAR(36)
    name : VARCHAR
}

' WISHLIST ITEMS
TABLE(WishlistItems, "Wishlist Items") {
    PK(id) : CHAR(36)
    FK(wishlist_id) : CHAR(36)
    FK(product_id) : CHAR(36)
}
' Brands
TABLE(Brand, "Brand") {
    PK(id) : CHAR(36)
    name : VARCHAR(255) NOT NULL UNIQUE,
    description :TEXT,
    country : VARCHAR(100),
    created_at : TIMESTAMP DEFAULT CURRENT_TIMESTAMP

}



' ==============================
' RELATIONSHIPS
' ==============================
Users ||--o{ Sellers : owns
Sellers ||--o{ Products : lists
Products ||--o{ ProductVariants : has
Products ||--o{ ProductImages : has
Products ||--o{ Reviews : reviewed_by
Products ||--o{ ProductCategory : categorized_in
Categories ||--o{ ProductCategory : contains
Users ||--o{ Orders : places
Orders ||--o{ OrderItems : contains
Orders ||--|| Shipments : shipped_as
Orders ||--o{ Payments : paid_by
Users ||--o{ Addresses : has
Users ||--o{ Carts : owns
Carts ||--o{ CartItems : contains
Users ||--o{ Wishlists : owns
Wishlists ||--o{ WishlistItems : contains
Brand ||--o{ Products : contains

@enduml
